<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Technician Repair Form</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    form {
      max-width: 1000px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    label { font-weight: bold; }
    input, select, textarea, button {
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    button:not(.full-width) {
      width: auto;
    }
    .full-width { grid-column: 1 / 3; }
    fieldset {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 10px;
    }
    .readonly { background-color: #f4f4f4; }
    .section-title {
      font-size: 18px;
      margin-top: 30px;
      grid-column: 1 / 3;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }
    #logout { float: right; margin-bottom: 10px; }
  </style>
  <script>
    const jobData = [
      {"job_description":"Power Plug (Complete) Male - Replace","job_code":"A001A","part_number":"22-02378-00PK10","part_description":"Plug, Power","labour_hours":0.5},
      {"job_description":"Cable, 460 V  - Replace","job_code":"A002A","part_number":"22-66654-20","part_description":"Cable MSC ContainerFlex FG7OK 4G4 11awg (per meter)","labour_hours":0.5},
      {"job_description":"Humidity Sensor  - Replace","job_code":"A037A","part_number":"76-66694-00","part_description":"Sensor, Humidity W/Bracket  (HS)","labour_hours":1.25},
      {"job_description":"Evaporator access panel   - Remove and refit","job_code":"B082E","part_number":"N/A","part_description":"N/A","labour_hours":0.25},
      {"job_description":"Cable, 460 V  - Splice","job_code":"A002X","part_number":"22-50463-00PK5","part_description":"SPLICE KIT FAST III","labour_hours":0.5},
      {"job_description":"Condenser fan motor capacitor - Replace","job_code":"A005A","part_number":"22-50088-00","part_description":"Capacitor, EF, 20uF (High Speed)","labour_hours":1.5},
      {"job_description":"Condenser grille  - Remove and refit","job_code":"B077E","part_number":"N/A","part_description":"N/A","labour_hours":0.25},
      {"job_description":"Service Fee","job_code":"F003U","part_number":"N/A","part_description":"N/A","labour_hours":0.75},
      {"job_description":"Controller  - Replace","job_code":"A018A","part_number":"12-56012","part_description":"Controller ML3, Green Label, Repaired","labour_hours":1.0},
      {"job_description":"Controller Key Pad  - Replace","job_code":"A039A","part_number":"79-66669-05","part_description":"Keypad Assy","labour_hours":0.5},
      {"job_description":"Coil Assembly Condenser - Replace","job_code":"B075A","part_number":"81-04203-25","part_description":"Condenser Coil (ALU/ALU)","labour_hours":4.0},
      {"job_description":"Coil Assembly Condenser - Replace","job_code":"B075A","part_number":"69NT43-202-20PK5","part_description":"Condenser Coil, 4-Row","labour_hours":4.0},
      {"job_description":"Coil Assembly Condenser - Replace","job_code":"B075A","part_number":"81-04203-21","part_description":"Condenser Coil, Assembly (excl all related jobs)","labour_hours":4.0},
      {"job_description":"Compressor, complete (with motor) - Replace","job_code":"B064A","part_number":"18-10129-22","part_description":"COMPRESSOR, THINLINE","labour_hours":3.25},
      {"job_description":"Evaporator Fan Motor  - Replace","job_code":"A030A","part_number":"54-00742-00","part_description":"Motor, evaporator","labour_hours":2.0}
    ];

    const USERS = {
      "Admin": "admin123",
      "Brahim Moukafih": "bm123",
      "Christophe Jongenelen": "cj123",
      "Hassan Ouchan": "ho123",
      "Marc Eyckmans": "me123",
      "Mohammed Ballafkih": "mb123",
      "Yannick Standaert": "ys123",
      "Youssef Stitou": "yst123"
    };

    function handleJobSelect(inputEl, index) {
      const selected = inputEl.value;
      const match = jobData.find(job => job.job_description === selected);
      document.getElementById("jobCode_" + index).value = match?.job_code || '';
      document.getElementById("partNumber_" + index).value = match?.part_number || '';
      document.getElementById("partDesc_" + index).value = match?.part_description || '';
      document.getElementById("labour_" + index).value = match?.labour_hours || '';
    }

    function validateLogin() {
      const name = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if (USERS[name] === pass) {
        sessionStorage.setItem("technicianName", name);
        location.reload();
      } else {
        alert("Invalid credentials");
      }
    }

    function addJob() {
      const container = document.getElementById("jobContainer");
      const index = container.children.length + 1;
      const datalistId = "jobList_" + index;
      const options = jobData.map(j => `<option value="${j.job_description}">`).join("");
      const fieldset = document.createElement("fieldset");

      fieldset.innerHTML = `
        <legend>Job ${index}</legend>
        <label>Job Description</label>
        <input type="text" list="${datalistId}" oninput="handleJobSelect(this, ${index})">
        <datalist id="${datalistId}">${options}</datalist>
        <label>Job Code</label>
        <input type="text" id="jobCode_${index}" class="readonly" readonly>
        <label>Part Number</label>
        <input type="text" id="partNumber_${index}" class="readonly" readonly>
        <label>Part Description</label>
        <input type="text" id="partDesc_${index}" class="readonly" readonly>
        <label>Old Part Serial</label>
        <input type="text" name="old_serial_${index}">
        <label>New Part Serial</label>
        <input type="text" name="new_serial_${index}">
        <label>Quantity</label>
        <input type="text" name="quantity_${index}">
        <input type="hidden" id="labour_${index}">
      `;
      container.appendChild(fieldset);
    }

    function addAlarm() {
      const container = document.getElementById("alarmSection");
      const input = document.createElement("input");
      input.type = "text";
      input.name = "alarm" + (container.children.length + 1);
      container.appendChild(input);
    }

    function addPhoto(sectionId) {
      const container = document.getElementById(sectionId);
      const input = document.createElement("input");
      input.type = "file";
      input.name = sectionId + "_extra";
      container.appendChild(input);
    }

    function logout() {
      sessionStorage.removeItem("technicianName");
      location.reload();
    }

    window.onload = function () {
      const tech = sessionStorage.getItem("technicianName");
      if (!tech) {
        document.getElementById("loginSection").style.display = "block";
        document.getElementById("formSection").style.display = "none";
      } else {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("formSection").style.display = "block";
        document.getElementById("naam").value = tech;
      }
      addJob();
    }
  </script>
</head>
<body>
  <div id="loginSection">
    <label>Username:</label>
    <input type="text" id="username">
    <label>Password:</label>
    <input type="password" id="password">
    <button onclick="validateLogin()">Login</button>
  </div>

  <div id="formSection" style="display:none">
    <button id="logout" onclick="logout()">Logout</button>
    <form>
      <label for="naam">Technician</label>
      <input type="text" id="naam" readonly>

      <div class="section-title">Photos</div>
      <div id="fotos_voor">
        <label>Before Repair</label>
        <input type="file" name="before_photo">
      </div>
      <button type="button" onclick="addPhoto('fotos_voor')">Add Before Photo</button>

      <div id="fotos_na">
        <label>After Repair</label>
        <input type="file" name="after_photo">
      </div>
      <button type="button" onclick="addPhoto('fotos_na')">Add After Photo</button>

      <div class="section-title">Alarms</div>
      <div id="alarmSection"></div>
      <button type="button" onclick="addAlarm()">Add Alarm</button>

      <div class="section-title">Jobs</div>
      <div id="jobContainer"></div>
      <button type="button" onclick="addJob()">Add Job</button>
    </form>
  </div>
</body>
</html>
