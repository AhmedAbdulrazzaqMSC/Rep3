<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Technician Repair Form</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    form {
      max-width: 1000px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    label { font-weight: bold; }
    input, select, textarea, button {
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    button:not(.full-width) { width: auto; }
    .full-width { grid-column: 1 / 3; }
    fieldset {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 10px;
    }
    .readonly { background-color: #f4f4f4; }
    .section-title {
      font-size: 18px;
      margin-top: 30px;
      grid-column: 1 / 3;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }
    #logout { float: right; margin-bottom: 10px; }
    #loginError { color: red; }
  </style>
  <script>
    const USERS = {
      "Admin": "admin123",
      "Brahim Moukafih": "bm123",
      "Christophe Jongenelen": "cj123",
      "Hassan Ouchan": "ho123",
      "Marc Eyckmans": "me123",
      "Mohammed Ballafkih": "mb123",
      "Yannick Standaert": "ys123",
      "Youssef Stitou": "yst123"
    };
    const jobData = [
      {"job_description": "Power Plug (Complete) Male - Replace", "job_code": "A001A", "part_number": "22-02378-00PK10", "part_description": "Plug, Power", "labour_hours": 0.5},
      {"job_description": "Cable, 460 V  - Replace", "job_code": "A002A", "part_number": "22-66654-20", "part_description": "Cable MSC ContainerFlex FG7OK 4G4 11awg (per meter)", "labour_hours": 0.5},
      {"job_description": "Humidity Sensor  - Replace", "job_code": "A037A", "part_number": "76-66694-00", "part_description": "Sensor, Humidity W/Bracket  (HS)", "labour_hours": 1.25},
      {"job_description": "Evaporator access panel   - Remove and refit", "job_code": "B082E", "part_number": "N/A", "part_description": "N/A", "labour_hours": 0.25},
      {"job_description": "Cable, 460 V  - Splice", "job_code": "A002X", "part_number": "22-50463-00PK5", "part_description": "SPLICE KIT FAST III", "labour_hours": 0.5}
    ];

    function doLogin() {
      const name = document.getElementById("techLoginName").value.trim();
      const pass = document.getElementById("techPassword").value.trim();
      if (USERS[name] && USERS[name] === pass) {
        sessionStorage.setItem("technicianName", name);
        loadTechnician();
      } else {
        document.getElementById("loginError").innerText = "Invalid name or password.";
      }
    }

    function loadTechnician() {
      const name = sessionStorage.getItem("technicianName");
      if (name) {
        document.getElementById("naam").value = name;
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("formSection").style.display = "block";
      } else {
        document.getElementById("loginSection").style.display = "block";
        document.getElementById("formSection").style.display = "none";
      }
    }

    function logout() {
      sessionStorage.removeItem("technicianName");
      location.reload();
    }

    function addJob() {
      const container = document.getElementById("jobContainer");
      const index = container.children.length + 1;
      const fieldset = document.createElement("fieldset");
      const datalistId = "jobList_" + index;
      const options = jobData.map(j => `<option value="${j.job_description}">`).join("");

      fieldset.innerHTML = `
        <legend>Job ${index}</legend>
        <label>Job Description</label>
        <input type="text" list="${datalistId}" oninput="handleJobSelect(this, ${index})" placeholder="Start typing...">
        <datalist id="${datalistId}">${options}</datalist>
        <label>Job Code</label>
        <input type="text" id="jobCode_${index}" class="readonly" readonly>
        <label>Part Number</label>
        <input type="text" id="partNumber_${index}" class="readonly" readonly>
        <label>Part Description</label>
        <input type="text" id="partDesc_${index}" class="readonly" readonly>
        <label>Quantity</label>
        <input type="text" id="quantity_${index}" name="quantity_${index}">
        <div style="display: flex; gap: 20px;">
          <div style="flex: 1;">
            <label>Old Serial Number</label>
            <input type="text" id="old_serial_${index}" name="old_serial_${index}">
          </div>
          <div style="flex: 1;">
            <label>New Serial Number</label>
            <input type="text" id="new_serial_${index}" name="new_serial_${index}">
          </div>
        </div>
        <input type="hidden" id="labour_${index}">
      `;
      container.appendChild(fieldset);
    }

    function handleJobSelect(inputEl, index) {
      const selected = inputEl.value;
      const match = jobData.find(job => job.job_description === selected);
      document.getElementById("jobCode_" + index).value = match?.job_code || '';
      document.getElementById("partNumber_" + index).value = match?.part_number || '';
      document.getElementById("partDesc_" + index).value = match?.part_description || '';
      document.getElementById("labour_" + index).value = match?.labour_hours || '';
    }

    function addAlarm() {
      const container = document.getElementById("alarmContainer");
      const index = container.children.length + 1;
      const input = document.createElement("input");
      input.type = "text";
      input.name = "alarm_" + index;
      input.placeholder = "Alarm " + index;
      container.appendChild(input);
    }

    function addPhoto(sectionId) {
      const container = document.getElementById(sectionId);
      const input = document.createElement("input");
      input.type = "file";
      input.name = sectionId + "_extra";
      container.appendChild(input);
    }

    window.onload = function() {
      loadTechnician();
      addJob();
      addAlarm();
    };
  </script>
</head>
<body>
<!-- BODY OMITTED FOR BREVITY. FORM LAYOUT UNCHANGED -->
</body>
</html>
