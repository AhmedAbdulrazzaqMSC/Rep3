<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Technician Repair Form</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    form {
      max-width: 1000px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    label { font-weight: bold; }
    input, select, textarea, button {
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    button:not(.full-width) {
      width: auto;
    }
    .full-width { grid-column: 1 / 3; }
    fieldset {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 10px;
    }
    .readonly { background-color: #f4f4f4; }
    .section-title {
      font-size: 18px;
      margin-top: 30px;
      grid-column: 1 / 3;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }
    #logout { float: right; margin-bottom: 10px; }
  </style>
  <script>
    const USERS = {
      "Admin": "admin123",
      "Brahim Moukafih": "bm123",
      "Christophe Jongenelen": "cj123",
      "Hassan Ouchan": "ho123",
      "Marc Eyckmans": "me123",
      "Mohammed Ballafkih": "mb123",
      "Yannick Standaert": "ys123",
      "Youssef Stitou": "yst123"
    };

    const jobData = [
      {"job_description": "Power Plug (Complete) Male - Replace", "job_code": "A001A", "part_number": "22-02378-00PK10", "part_description": "Plug, Power", "labour_hours": 0.5},
      {"job_description": "Cable, 460 V  - Replace", "job_code": "A002A", "part_number": "22-66654-20", "part_description": "Cable MSC ContainerFlex FG7OK 4G4 11awg (per meter)", "labour_hours": 0.5},
      {"job_description": "Humidity Sensor  - Replace", "job_code": "A037A", "part_number": "76-66694-00", "part_description": "Sensor, Humidity W/Bracket  (HS)", "labour_hours": 1.25},
      {"job_description": "Evaporator access panel   - Remove and refit", "job_code": "B082E", "part_number": "N/A", "part_description": "N/A", "labour_hours": 0.25},
      {"job_description": "Cable, 460 V  - Splice", "job_code": "A002X", "part_number": "22-50463-00PK5", "part_description": "SPLICE KIT FAST III", "labour_hours": 0.5},
      {"job_description": "Condenser fan motor capacitor - Replace", "job_code": "A005A", "part_number": "22-50088-00", "part_description": "Capacitor, EF, 20uF (High Speed)", "labour_hours": 1.5},
      {"job_description": "Service Fee", "job_code": "F003U", "part_number": "N/A", "part_description": "N/A", "labour_hours": 0.75},
      {"job_description": "Controller  - Replace", "job_code": "A018A", "part_number": "12-56012", "part_description": "Controller ML3, Green Label, Repaired", "labour_hours": 1.0}
    ];

    function handleJobSelect(inputEl, index) {
      const selected = inputEl.value;
      const match = jobData.find(job => job.job_description === selected);
      document.getElementById("jobCode_" + index).value = match?.job_code || '';
      document.getElementById("partNumber_" + index).value = match?.part_number || '';
      document.getElementById("partDesc_" + index).value = match?.part_description || '';
      document.getElementById("labour_" + index).value = match?.labour_hours || '';
    }

    function validateLogin() {
      const name = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if (USERS[name] === pass) {
        sessionStorage.setItem("technicianName", name);
        location.reload();
      } else {
        alert("Invalid credentials");
      }
    }

    function addJob() {
      const container = document.getElementById("jobContainer");
      const index = container.children.length + 1;
      const datalistId = "jobList_" + index;
      const options = jobData.map(j => `<option value="${j.job_description}">`).join("");
      const fieldset = document.createElement("fieldset");

      fieldset.innerHTML = `
        <legend>Job ${index}</legend>
        <label>Job Description</label>
        <input type="text" list="${datalistId}" oninput="handleJobSelect(this, ${index})">
        <datalist id="${datalistId}">${options}</datalist>
        <label>Job Code</label>
        <input type="text" id="jobCode_${index}" class="readonly" readonly>
        <label>Part Number</label>
        <input type="text" id="partNumber_${index}" class="readonly" readonly>
        <label>Part Description</label>
        <input type="text" id="partDesc_${index}" class="readonly" readonly>
        <label>Old Part Serial</label>
        <input type="text" name="old_serial_${index}">
        <label>New Part Serial</label>
        <input type="text" name="new_serial_${index}">
        <label>Quantity</label>
        <input type="text" name="quantity_${index}">
        <input type="hidden" id="labour_${index}">
      `;
      container.appendChild(fieldset);
    }

    function addAlarm() {
      const container = document.getElementById("alarmSection");
      const input = document.createElement("input");
      input.type = "text";
      input.name = "alarm" + (container.children.length + 1);
      container.appendChild(input);
    }

    function logout() {
      sessionStorage.removeItem("technicianName");
      location.reload();
    }

    window.onload = function () {
      const tech = sessionStorage.getItem("technicianName");
      if (!tech) {
        document.getElementById("loginSection").style.display = "block";
        document.getElementById("formSection").style.display = "none";
      } else {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("formSection").style.display = "block";
        document.getElementById("naam").value = tech;
      }
      addJob();
    }
  </script>
</head>
<body>
  <div id="loginSection" style="display:none">
    <h2>Technician Login</h2>
    <label>Name:</label><input type="text" id="username">
    <label>Password:</label><input type="password" id="password">
    <button onclick="validateLogin()">Login</button>
  </div>

  <div id="formSection" style="display:none">
    <button id="logout" onclick="logout()">Logout</button>
    <h2>Technician Repair Form</h2>
    <form id="repairForm">
      <label for="naam">Technician</label>
      <input type="text" id="naam" name="naam" readonly>

      <label>CONTAINERNR</label><input type="text">
      <label>DATUM</label><input type="date">
      <label>MODEL</label><input type="text">
      <label>DATUM IN DIENST</label><input type="text">
      <label>SERIENR.</label><input type="text">
      <label>WARRANTY ID NR</label><input type="text">
      <label>DATUM IN SERVICE</label><input type="text">
      <label>GARANTIE</label><input type="text">
      <label>AANTAL MAANDEN GARANTIE</label><input type="text">

      <label>SETPOINT Â°C</label><input type="number">
      <label>VENTS</label><input type="text">
      <label>HUM</label><input type="text">
      <label>AMBIENT</label><input type="text">
      <label>SUPPLY VOOR</label><input type="text">
      <label>SUPPLY NA</label><input type="number">
      <label>RETURN VOOR</label><input type="text">
      <label>RETURN NA</label><input type="number">

      <div class="section-title">Photos</div>
      <label>Photos Before</label><input type="file" name="photo_before">
      <label>Photos After</label><input type="file" name="photo_after">

      <div class="section-title">Alarms</div>
      <div id="alarmSection" class="full-width">
        <input type="text" name="alarm_1">
      </div>
      <button type="button" onclick="addAlarm()">Add Alarm</button>

      <div class="section-title">Jobs</div>
      <div id="jobContainer" class="full-width"></div>
      <button type="button" onclick="addJob()">Add Job</button>

      <label>TEMPERATUUR IN-RANGE NA REPAIR</label><input type="text">
      <label>OMSCHRIJVING / PROBLEEM</label><textarea rows="2"></textarea>
      <label>OPMERKINGEN</label><textarea rows="2"></textarea>

      <button class="full-width" type="submit">Submit Report</button>
    </form>
  </div>
</body>
</html>
